<% template = f.object.model.class.to_s.underscore %>
<% creator_types = HykuAddons::NameTypeService.new.select_active_options.flatten.uniq! %>

<% f.object.creator_list.each do |hash| %>
	<div data-duplicate>
		<% field_options = {
			field_slug: :creator_name_type,
			select_options: creator_types,
			required: template != "collection",
			field_args: {
				class: 'form-control',
				data: {
					toggle_control: 1,
					on_change_event: :toggle_group,
				}
			},
			field_group: :creator,
			template: template,
			hash: hash
		} %>
		<%= render "records/edit_fields/attribution_partials/select_field", field_options %>

		<div data-toggle-group="Organisational">
			<% # TODO: wo out why setting the name fields as required causes the deposit form to not register the meta data was entered %>
			<% [
				{ field_type: :text, field_slug: :creator_organization_name, required: false },
				{ field_type: :text, field_slug: :creator_ror, required: false },
				{ field_type: :text, field_slug: :creator_grid, required: false },
				{ field_type: :text, field_slug: :creator_wikidata, required: false}
			].each do |field| %>
				<% options = { field_group: :creator, template: template, hash: hash }.merge(field) %>
				<%= render "records/edit_fields/attribution_partials/#{field[:field_type]}_field", options %>
			<% end %>
		</div>

		<div data-toggle-group="Personal">
			<% [
				{ field_type: :text, field_slug: :creator_family_name, required: false },
				{ field_type: :text, field_slug: :creator_given_name, required: false },
				{ field_type: :text, field_slug: :creator_orcid, required: false },
				{ field_type: :select, field_slug: :creator_institutional_relationship, required: false, select_options: ['Staff member', 'Research associate'], field_args: { multiple: true } }
			].each do |field| %>
				<% options = { field_group: :creator, template: template, hash: hash }.merge(field) %>
				<%= render "records/edit_fields/attribution_partials/#{field[:field_type]}_field", options %>
			<% end %>
		</div>

		<% field_options = { field_slug: :creator_isni, required: false, field_group: :creator, template: template, hash: hash } %>
		<%= render "records/edit_fields/attribution_partials/text_field", field_options %>

		<div class="form-group">
			<a href="#" class="text-danger js-select-toggle-remove form-group" data-duplicate-remove>
				<span class="glyphicon glyphicon-remove"></span>
				<span class="controls-remove-text">Remove</span>
			</a>
			|
			<a href="#" class="js-select-toggle-add" data-duplicte-add>Add another</a>
		</div>

		<hr>
	</div>
<% end %>

