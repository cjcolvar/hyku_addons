<% template = f.object.model.class.to_s.underscore %>
<% creator_types = HykuAddons::NameTypeService.new.select_active_options.flatten.uniq! %>

<% f.object.creator_list.each do |hash| %>
	<div class="ubiquity-meta-creator">
		<div class="form-group">
			<% required = template != 'collection' %>

			<label class="control-label multi_value optional" for="<%= template %>_creator_name_type">
				Creator name type
				<% if required %>
					<span class="label label-info required-tag">required</span>
				<% end %>
			</label>

			<% opts = options_for_select(creator_types, selected: hash.dig("creator_name_type")) %>
			<% select_params = { required: required, class: 'ubiquity_creator_name_type form-control', data: { field_name:'ubiquity_creator_name_type' } } %>
			<%= select_tag "#{template}[creator][][creator_name_type]", opts, select_params %>
			<p class="help-block">The person or group responsible for the work. Usually this is the author of the content.</p>
		</div>

		<div class="ubiquity_organization_fields js-creator-group">
			<% # TODO: work out why setting the name fields as required causes the deposit form to not register the meta data was entered %>
			<% [
				{ field_type: :text, field_slug: :creator_organization_name, required: false },
				{ field_type: :text, field_slug: :creator_ror, required: false },
				{ field_type: :text, field_slug: :creator_grid, required: false },
				{ field_type: :text, field_slug: :creator_wikidata, required: false}
			].each do |field| %>
				<% options = { field_group: :creator, template: template, hash: hash }.merge(field) %>
				<%= render "records/edit_fields/attribution_partials/#{field[:field_type]}_field", options %>
			<% end %>
		</div>

		<div class="ubiquity_personal_fields js-creator-group">
			<% [
				{ field_type: :text, field_slug: :creator_family_name, required: false },
				{ field_type: :text, field_slug: :creator_given_name, required: false },
				{ field_type: :text, field_slug: :creator_orcid, required: false },
				{ field_type: :select, field_slug: :creator_institutional_relationship, required: false, select_options: ['Staff member', 'Research associate'], field_args: { multiple: true } }
			].each do |field| %>
				<% options = { field_group: :creator, template: template, hash: hash }.merge(field) %>
				<%= render "records/edit_fields/attribution_partials/#{field[:field_type]}_field", options %>
			<% end %>
		</div>

		<% field_options = { field_type: :text, field_slug: :creator_isni, required: false, field_group: :creator, template: template, hash: hash } %>
		<%= render "records/edit_fields/attribution_partials/#{field_options[:field_type]}_field", field_options %>

		<div class="form-group">
			<a href="#" class="text-danger remove_creator form-group">
				<span class="glyphicon glyphicon-remove"></span>
				<span class="controls-remove-text">Remove</span>
			</a>
			|
			<a href="#" class="add_creator">Add another</a>
		</div>
	</div>
<% end %>

